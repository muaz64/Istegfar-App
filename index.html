<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#064420">
    <link rel="apple-touch-icon" href="icon.png">
    <title>ইস্তেগফার - রিমাইন্ডার</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <script>
        // Professional Service Worker Registration with Auto-Update
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New content is available; force refresh
                                    window.location.reload();
                                }
                            }
                        };
                    };
                }).catch(err => console.log("SW Registration Failed", err));
            });
        }
    </script>

    <style>
        :root {
            --primary-dark: #064420;
            --primary-light: #1b5e20;
            --accent-gold: #d4af37;
            --soft-white: #fdfffc;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        .app-container {
            background: var(--soft-white);
            width: 100%;
            max-width: 420px;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header {
            background: var(--primary-dark);
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png');
            padding: 30px 20px;
            text-align: center;
            color: var(--accent-gold);
            border-bottom: 5px solid var(--accent-gold);
        }

        .header i {
            font-size: 45px;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .header h1 {
            margin: 0;
            font-size: 22px;
            letter-spacing: 1px;
        }

        .header p {
            margin: 8px 0 0;
            font-size: 15px;
            color: #eee;
        }

        #installBtn {
            display: none;
            margin: 15px auto 0;
            background: var(--accent-gold);
            color: var(--primary-dark);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .content {
            padding: 20px;
        }

        .card {
            background: white;
            padding: 18px;
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            transition: 0.3s;
        }

        .card-title {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 12px;
            font-size: 15px;
        }

        .card-title i {
            margin-right: 10px;
            color: var(--accent-gold);
        }

        /* Tasbih Circle UI */
        .zikir-circle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
        }

        .zikir-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--primary-dark);
            border: 8px solid var(--accent-gold);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
            user-select: none;
        }

        .zikir-circle:active {
            transform: scale(0.92);
        }

        .reset-btn {
            margin-top: 15px;
            background: #666;
            width: auto;
            padding: 8px 20px;
            font-size: 12px;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            text-align: center;
            background: #fafafa;
            margin-bottom: 10px;
        }

        .checkbox-container {
            margin: 10px 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            font-size: 14px;
            color: #555;
        }

        button {
            width: 100%;
            padding: 14px;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            background: #fff9e6;
            border-left: 4px solid var(--accent-gold);
            padding: 12px;
            border-radius: 10px;
            color: #856404;
            font-size: 13px;
            margin: 15px 0;
            display: none;
        }

        /* Toast Notification Styles */
        .toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 14px;
            z-index: 1000;
            transition: bottom 0.4s;
            box-shadow: var(--shadow);
            white-space: nowrap;
        }

        .toast.show {
            bottom: 30px;
        }

        .footer-credit {
            margin-top: 20px;
            padding-bottom: 5px;
            text-align: center;
            font-size: 12px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        @media (max-width: 360px) {
            .header h1 {
                font-size: 18px;
            }

            .zikir-circle {
                width: 110px;
                height: 110px;
                font-size: 30px;
            }
        }
    </style>
</head>

<body>

    <div id="toast" class="toast">সেভ করা হয়েছে!</div>

    <div class="app-container">
        <div class="header">
            <h1>All praises to <b>ALLAH (SWT)</b></h1>
            <br>
            <i class="fa-solid fa-mosque"></i>
            <h2>ইস্তেগফার রিমাইন্ডার</h2>
            <p>আসতাগফিরুল্লাহিল আজিম</p>
            <button id="installBtn"><i class="fa-solid fa-download"></i> অ্যাপটি সেভ করুন</button>
        </div>

        <div class="content">
            <div class="card">
                <div class="card-title"><i class="fa-solid fa-fingerprint"></i> তসবিহ কাউন্টার</div>
                <div class="zikir-circle-container">
                    <div class="zikir-circle" id="countNum" onclick="addCount()">0</div>
                    <button class="reset-btn" onclick="resetCount()"><i class="fa-solid fa-rotate-right"></i>
                        রিসেট</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title"><i class="fa-solid fa-clock"></i> প্রতিদিন নির্দিষ্ট সময়</div>
                <input type="time" id="timeInp">
                <button onclick="saveDaily()"><i class="fa-solid fa-bell"></i> সেট করুন</button>
            </div>

            <div class="card">
                <div class="card-title"><i class="fa-solid fa-hourglass-half"></i> কত মিনিট পর পর?</div>
                <input type="number" id="minInp" placeholder="যেমন: ৩০" min="1">
                <div class="checkbox-container">
                    <input type="checkbox" id="soundChk" checked>
                    <label for="soundChk">সাউন্ড বাজবে</label>
                </div>
                <button onclick="saveInterval()"><i class="fa-solid fa-repeat"></i> বিরতি সেট করুন</button>
            </div>

            <div id="statusBox" class="status-badge"></div>

            <div class="footer-btns" style="text-align:center;">
                <button style="color:#d32f2f; background:none; text-decoration:underline; font-size:13px;"
                    onclick="resetAll()">
                    সব মুছে ফেলুন
                </button>
            </div>
            <div class="footer-credit">
                <p>Developed by <b>Muaz</b> & <b>Rasel</b></p>
            </div>
        </div>
    </div>

    <script>
        let dailyTimer, intervalTimer, deferredPrompt;
        let count = parseInt(localStorage.getItem('ist_count')) || 0;
        document.getElementById('countNum').innerText = count;

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            if (window.matchMedia('(display-mode: standalone)').matches) return;
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'flex';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') document.getElementById('installBtn').style.display = 'none';
                deferredPrompt = null;
            }
        });

        function addCount() {
            count++;
            document.getElementById('countNum').innerText = count;
            localStorage.setItem('ist_count', count);
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function resetCount() {
            count = 0;
            document.getElementById('countNum').innerText = 0;
            localStorage.setItem('ist_count', 0);
            showToast("কাউন্টার রিসেট হয়েছে");
        }

        function saveDaily() {
            const val = document.getElementById('timeInp').value;
            if (!val) return showToast("সময় নির্বাচন করুন");
            localStorage.setItem('ist_daily', val);
            startDaily(val);
            updateUI();
            showToast("প্রতিদিনের সময় সেভ হয়েছে");
        }

        function startDaily(time) {
            if (dailyTimer) clearTimeout(dailyTimer);
            const [h, m] = time.split(':').map(Number);
            const now = new Date();
            let target = new Date();
            target.setHours(h, m, 0, 0);
            if (target <= now) target.setDate(target.getDate() + 1);
            dailyTimer = setTimeout(() => {
                notify("ইস্তেগফার সময়", getRandomIstighfar());
                startDaily(time);
            }, target - now);
        }

        function saveInterval() {
            const val = parseInt(document.getElementById('minInp').value);
            if (!val || val < 1) return showToast("সঠিক মিনিট দিন");
            localStorage.setItem('ist_interval', val);
            startInterval(val);
            updateUI();
            showToast("বিরতি সেভ হয়েছে");
        }

        function startInterval(min) {
            if (intervalTimer) clearInterval(intervalTimer);
            intervalTimer = setInterval(() => {
                notify("জিকির রিমাইন্ডার", getRandomIstighfar());
            }, min * 60 * 1000);
        }

        function updateUI() {
            const d = localStorage.getItem('ist_daily');
            const i = localStorage.getItem('ist_interval');
            const box = document.getElementById('statusBox');
            if (!d && !i) { box.style.display = 'none'; return; }
            box.style.display = 'block';
            box.innerHTML = `<strong>সক্রিয় রিমাইন্ডার:</strong><br>${d ? '• প্রতিদিন ' + d + ' টায়<br>' : ''}${i ? '• প্রতি ' + i + ' মিনিট অন্তর' : ''}`;
        }

        function resetAll() {
            localStorage.clear();
            location.reload();
        }

        const istighfarList = ["আসতাগফিরুল্লাহিল আজীম ওয়া আতুবু ইলাইহি", "আসতাগফিরুল্লাহ ওয়া আতুবু ইলাইহি", "আসতাগফিরুল্লাহ রাব্বি ওয়া আতুবু ইলাইহি", "লা ইলাহা ইল্লা আনতা সুবহানাকা ইন্নি কুনতু মিনাজ জালিমীন", "আসতাগফিরুল্লাহ ওয়া আতুবু ইলাইহি ওয়া আসআলুহুত তাওবাহ ওয়াল মাগফিরাহ"];
        function getRandomIstighfar() { return istighfarList[Math.floor(Math.random() * istighfarList.length)]; }

        function notify(title, msg) {
            if (Notification.permission !== "granted") return;
            new Notification(title, { body: msg, icon: 'icon.png' });
            if (document.getElementById('soundChk')?.checked) {
                new Audio('https://www.soundjay.com/buttons/beep-07a.mp3').play().catch(() => { });
            }
        }

        window.onload = async () => {
            if ("Notification" in window) await Notification.requestPermission();
            const d = localStorage.getItem('ist_daily');
            const i = localStorage.getItem('ist_interval');
            if (d) startDaily(d);
            if (i) startInterval(parseInt(i));
            updateUI();
        };
    </script>
</body>

</html>