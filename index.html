<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#064420">
    <link rel="apple-touch-icon" href="icon.png">
    <title>ইস্তেগফার - রিমাইন্ডার</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log("Service Worker Registered"))
                .catch(err => console.log("SW Registration Failed", err));
        }
    </script>

    <style>
        :root {
            --primary-dark: #064420;
            --primary-light: #1b5e20;
            --accent-gold: #d4af37;
            --soft-white: #fdfffc;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        .app-container {
            background: var(--soft-white);
            width: 100%;
            max-width: 420px;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .header {
            background: var(--primary-dark);
            background-image: url('https://www.transparenttextures.com/patterns/islamic-art.png');
            padding: 30px 20px;
            text-align: center;
            color: var(--accent-gold);
            border-bottom: 5px solid var(--accent-gold);
        }

        .header i {
            font-size: 45px;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .header h1 {
            margin: 0;
            font-size: 22px;
            letter-spacing: 1px;
        }

        .header p {
            margin: 8px 0 0;
            font-size: 15px;
            color: #eee;
        }

        /* New Install Button Style */
        #installBtn {
            display: none;
            margin: 15px auto 0;
            background: var(--accent-gold);
            color: var(--primary-dark);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .content {
            padding: 20px;
        }

        .card {
            background: white;
            padding: 18px;
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid #eee;
            transition: 0.3s;
        }

        .card-title {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 12px;
            font-size: 15px;
        }

        .card-title i {
            margin-right: 10px;
            color: var(--accent-gold);
        }

        /* New Counter Styles */
        .counter-display {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary-dark);
            text-align: center;
            margin: 10px 0;
        }

        .counter-btns {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            text-align: center;
            background: #fafafa;
            margin-bottom: 10px;
        }

        .checkbox-container {
            margin: 10px 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            font-size: 14px;
            color: #555;
        }

        button {
            width: 100%;
            padding: 14px;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        button:active {
            transform: scale(0.98);
        }

        .status-badge {
            background: #fff9e6;
            border-left: 4px solid var(--accent-gold);
            padding: 12px;
            border-radius: 10px;
            color: #856404;
            font-size: 13px;
            margin: 15px 0;
            display: none;
        }

        .footer-btns {
            text-align: center;
            margin-top: 10px;
        }

        .clear-link {
            color: #d32f2f;
            background: none;
            border: none;
            font-size: 13px;
            cursor: pointer;
            text-decoration: underline;
        }

        .footer-credit {
            margin-top: 20px;
            padding-bottom: 5px;
            text-align: center;
            font-size: 12px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .footer-credit b {
            color: var(--primary-dark);
        }

        /* Responsiveness for Mobile */
        @media (max-width: 360px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 18px;
            }

            .card {
                padding: 15px;
            }

            .counter-display {
                font-size: 36px;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <div class="header">
            <h1>All praises to <b>ALLAH (SWT)</b></h1>
            <br>
            <i class="fa-solid fa-mosque"></i>
            <h2>ইস্তেগফার রিমাইন্ডার</h2>
            <p>আসতাগফিরুল্লাহিল আজিম</p>
            <button id="installBtn"><i class="fa-solid fa-download"></i> অ্যাপটি সেভ করুন</button>
        </div>

        <div class="content">
            <div class="card">
                <div class="card-title"><i class="fa-solid fa-fingerprint"></i> তসবিহ কাউন্টার</div>
                <div class="counter-display" id="countNum">0</div>
                <div class="counter-btns">
                    <button onclick="addCount()"><i class="fa-solid fa-plus"></i> গণনা করুন</button>
                    <button style="background:#666;" onclick="resetCount()"><i
                            class="fa-solid fa-rotate-right"></i></button>
                </div>
            </div>

            <div class="card">
                <div class="card-title"><i class="fa-solid fa-clock"></i> প্রতিদিন নির্দিষ্ট সময়</div>
                <input type="time" id="timeInp">
                <button onclick="saveDaily()"><i class="fa-solid fa-bell"></i> সেট করুন</button>
            </div>

            <div class="card">
                <div class="card-title"><i class="fa-solid fa-hourglass-half"></i> কত মিনিট পর পর?</div>
                <input type="number" id="minInp" placeholder="যেমন: ৩০" min="1">
                <div class="checkbox-container">
                    <input type="checkbox" id="soundChk" checked>
                    <label for="soundChk">সাউন্ড বাজবে</label>
                </div>
                <button onclick="saveInterval()"><i class="fa-solid fa-repeat"></i> বিরতি সেট করুন</button>
            </div>

            <div id="statusBox" class="status-badge"></div>

            <div class="footer-btns">
                <button class="clear-link" onclick="resetAll()">
                    <i class="fa-solid fa-trash-can"></i> সব মুছে ফেলুন
                </button>
            </div>
            <div class="footer-credit">
                <p>Developed by <b>Muaz</b> & <b>Rasel</b></p>
            </div>
        </div>
    </div>

    <script>
        let dailyTimer, intervalTimer, deferredPrompt;

        // Counter Logic
        let count = parseInt(localStorage.getItem('ist_count')) || 0;
        document.getElementById('countNum').innerText = count;

        const installBtn = document.getElementById('installBtn');
        const istighfarList = [
            "আসতাগফিরুল্লাহিল আজীম ওয়া আতুবু ইলাইহি",
            "আসতাগফিরুল্লাহ ওয়া আতুবু ইলাইহি",
            "আসতাগফিরুল্লাহ রাব্বি ওয়া আতুবু ইলাইহি",
            "লা ইলাহা ইল্লা আনতা সুবহানাকা ইন্নি কুনতু মিনাজ জালিমীন",
            "আসতাগফিরুল্লাহ ওয়া আতুবু ইলাইহি ওয়া আসআলুহুত তাওবাহ ওয়াল মাগফিরাহ"
        ];

        // Install Button Logic - Vanishes if already installed
        window.addEventListener('beforeinstallprompt', (e) => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                return; // Do not show if app is already running in standalone mode
            }
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') installBtn.style.display = 'none';
                deferredPrompt = null;
            }
        });

        // Hide button if installed during session
        window.addEventListener('appinstalled', () => {
            installBtn.style.display = 'none';
        });

        function addCount() {
            count++;
            document.getElementById('countNum').innerText = count;
            localStorage.setItem('ist_count', count);
            if (window.navigator.vibrate) window.navigator.vibrate(50);
        }

        function resetCount() {
            if (confirm("কাউন্টার রিসেট করতে চান?")) {
                count = 0;
                document.getElementById('countNum').innerText = count;
                localStorage.setItem('ist_count', 0);
            }
        }

        async function requestNotificationPermission() {
            if (!("Notification" in window)) return false;
            if (Notification.permission === "granted") return true;
            return await Notification.requestPermission() === "granted";
        }

        function getRandomIstighfar() {
            return istighfarList[Math.floor(Math.random() * istighfarList.length)];
        }

        function notify(title, msg) {
            if (Notification.permission !== "granted") return;
            new Notification(title, { body: msg, icon: 'icon.png' });
            if (document.getElementById('soundChk')?.checked) {
                new Audio('https://www.soundjay.com/buttons/beep-07a.mp3').play().catch(() => { });
            }
        }

        function saveDaily() {
            const val = document.getElementById('timeInp').value;
            if (!val) return alert("সময় নির্বাচন করুন");
            localStorage.setItem('ist_daily', val);
            startDaily(val);
            updateUI();
        }

        function startDaily(time) {
            if (dailyTimer) clearTimeout(dailyTimer);
            const [h, m] = time.split(':').map(Number);
            const now = new Date();
            let target = new Date();
            target.setHours(h, m, 0, 0);
            if (target <= now) target.setDate(target.getDate() + 1);
            dailyTimer = setTimeout(() => {
                notify("ইস্তেগফার সময়", getRandomIstighfar());
                startDaily(time);
            }, target - now);
        }

        function saveInterval() {
            const val = parseInt(document.getElementById('minInp').value);
            if (!val || val < 1) return alert("সঠিক মিনিট দিন");
            localStorage.setItem('ist_interval', val);
            startInterval(val);
            updateUI();
        }

        function startInterval(min) {
            if (intervalTimer) clearInterval(intervalTimer);
            intervalTimer = setInterval(() => {
                notify("জিকির রিমাইন্ডার", getRandomIstighfar());
            }, min * 60 * 1000);
        }

        function initApp() {
            const d = localStorage.getItem('ist_daily');
            const i = localStorage.getItem('ist_interval');
            if (d) startDaily(d);
            if (i) startInterval(parseInt(i));
            updateUI();
        }

        function updateUI() {
            const d = localStorage.getItem('ist_daily');
            const i = localStorage.getItem('ist_interval');
            const box = document.getElementById('statusBox');
            if (!d && !i) { box.style.display = 'none'; return; }
            box.style.display = 'block';
            let html = "<strong>সক্রিয় রিমাইন্ডার:</strong><br>";
            if (d) html += `• প্রতিদিন ${d} টায়<br>`;
            if (i) html += `• প্রতি ${i} মিনিট অন্তর`;
            box.innerHTML = html;
        }

        function resetAll() {
            if (!confirm("সব রিমাইন্ডার মুছে ফেলতে চান?")) return;
            localStorage.clear();
            location.reload();
        }

        window.onload = async () => {
            await requestNotificationPermission();
            initApp();
        };
    </script>
</body>

</html>